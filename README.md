The goal of the algorithm in this repository is to correct the pointing instability of a laser in an optical setup, using two motorized mirrors (PIM1, Thorlabs), a piezomotor (KIM101, Thorlabs), a flip mirror (MFF101, Thorlabs) and two cameras (Basler). The flip mirror can point the beam towards the camera, which can then sense the deviation of the laser beam from the target pixel. This deviation is translated to a certain movement in steps of the piezomotor, which moves the motorized mirrors. When the beam is at the target position, the calibration is finished. After the calibration is complete, the mirror flips again and the beam can continue in the path. 

To use the script, first the target image of the beam has to be made on both cameras. This should be done after the setup is fully aligned. Then, in the algorithm_alignment script, some parameters need to be set. these parameters are the pixelsize (dependent on the camera used in the setup), the maximum number of attempts you want the algorithm to do for realignment before it quits, the distance between elements in your setup (A = distance between MM1 and MM2. B = distance between MM2 and cam1, C  = distance between cam1 and cam2). Lastly, the margin in number of pixels that the shift is allowed to have when the correction is 
considered 'good enough' needs to be set.

Also, a calibration needs to be done to calculate a slope that can convert a number of motor steps to a number of pixel shifts on camera 2. This calibration can be done by running the script calibration_piezo. In the current state of the script, the calibrations can not be done all in one run, as the beam tends to drift off the reach of the camera after a few measurements. 

Next, after changing the wavelength of the laser or after time, algorithm_alignment can be run. Here, you can adjust several parameters, such as the margin of the calibration (in pixels) and the steprate of the piezomotor. If you choose a steprate, a calibration of the piezomotor is started. This calibrates how many piezomotor steps correspond a pixel displacement. The calibration is saved. If you choose a different steprate, the calibration is done again. If you use the same steprate, the saved calibration is used. The algorithm moves the first motorized mirror in the setup, steering the beam back to the target pixel. If the current pixel is not yet within the margin of the target pixel, the process is repeated. After a certain amount of attempts (max_attempts) the algorithm stops and returns what the deviation is to the target pixel is.

The script calibration_piezo_steps_to_pixels can be used to check the calibration. The script is not necessary to be able to run the algorithm. Here, several measurements can be combined in different plots with a settable amount of steps and stepsize, to check if the linear fit is representative. 
